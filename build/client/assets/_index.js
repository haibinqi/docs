import{r as a,j as t}from"./jsx-runtime.js";import{c as Ee,B as D,I as q}from"./input.js";import{b as v,c as Ae,h as Se,d as Oe,f as I,u as F,P as E,g as _,j as L,k as Pe}from"./utils.js";import{P as Ie,h as Te,R as ke,u as Me,F as Fe,D as Le}from"./Combination.js";import{c as Z}from"./createLucideIcon.js";import"./index2.js";/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]],We=Z("copy",$e);/**
 * @license lucide-react v0.556.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],Ve=Z("x",ze),Q=a.forwardRef(({className:e,...s},o)=>t.jsx("textarea",{className:v("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:o,...s}));Q.displayName="Textarea";const X=a.forwardRef(({className:e,...s},o)=>t.jsx("div",{ref:o,className:v("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));X.displayName="Card";const Ge=a.forwardRef(({className:e,...s},o)=>t.jsx("div",{ref:o,className:v("flex flex-col space-y-1.5 p-6",e),...s}));Ge.displayName="CardHeader";const He=a.forwardRef(({className:e,...s},o)=>t.jsx("h3",{ref:o,className:v("text-2xl font-semibold leading-none tracking-tight",e),...s}));He.displayName="CardTitle";const Be=a.forwardRef(({className:e,...s},o)=>t.jsx("p",{ref:o,className:v("text-sm text-muted-foreground",e),...s}));Be.displayName="CardDescription";const Ue=a.forwardRef(({className:e,...s},o)=>t.jsx("div",{ref:o,className:v("p-6 pt-0",e),...s}));Ue.displayName="CardContent";const Je=a.forwardRef(({className:e,...s},o)=>t.jsx("div",{ref:o,className:v("flex items-center p-6 pt-0",e),...s}));Je.displayName="CardFooter";function qe(e){const s=Ke(e),o=a.forwardRef((n,r)=>{const{children:i,...d}=n,c=a.Children.toArray(i),p=c.find(Ze);if(p){const m=p.props.children,b=c.map(y=>y===p?a.Children.count(m)>1?a.Children.only(null):a.isValidElement(m)?m.props.children:null:y);return t.jsx(s,{...d,ref:r,children:a.isValidElement(m)?a.cloneElement(m,void 0,b):null})}return t.jsx(s,{...d,ref:r,children:i})});return o.displayName=`${e}.Slot`,o}function Ke(e){const s=a.forwardRef((o,n)=>{const{children:r,...i}=o;if(a.isValidElement(r)){const d=Xe(r),c=Qe(i,r.props);return r.type!==a.Fragment&&(c.ref=n?Ae(n,d):d),a.cloneElement(r,c)}return a.Children.count(r)>1?a.Children.only(null):null});return s.displayName=`${e}.SlotClone`,s}var Ye=Symbol("radix.slottable");function Ze(e){return a.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===Ye}function Qe(e,s){const o={...s};for(const n in s){const r=e[n],i=s[n];/^on[A-Z]/.test(n)?r&&i?o[n]=(...c)=>{const p=i(...c);return r(...c),p}:r&&(o[n]=r):n==="style"?o[n]={...r,...i}:n==="className"&&(o[n]=[r,i].filter(Boolean).join(" "))}return{...e,...o}}function Xe(e){var n,r;let s=(n=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:n.get,o=s&&"isReactWarning"in s&&s.isReactWarning;return o?e.ref:(s=(r=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:r.get,o=s&&"isReactWarning"in s&&s.isReactWarning,o?e.props.ref:e.props.ref||e.ref)}var S="Dialog",[ee]=Oe(S),[et,j]=ee(S),te=e=>{const{__scopeDialog:s,children:o,open:n,defaultOpen:r,onOpenChange:i,modal:d=!0}=e,c=a.useRef(null),p=a.useRef(null),[m,b]=Se({prop:n,defaultProp:r??!1,onChange:i,caller:S});return t.jsx(et,{scope:s,triggerRef:c,contentRef:p,contentId:I(),titleId:I(),descriptionId:I(),open:m,onOpenChange:b,onOpenToggle:a.useCallback(()=>b(y=>!y),[b]),modal:d,children:o})};te.displayName=S;var se="DialogTrigger",oe=a.forwardRef((e,s)=>{const{__scopeDialog:o,...n}=e,r=j(se,o),i=F(s,r.triggerRef);return t.jsx(E.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":z(r.open),...n,ref:i,onClick:_(e.onClick,r.onOpenToggle)})});oe.displayName=se;var $="DialogPortal",[tt,ae]=ee($,{forceMount:void 0}),re=e=>{const{__scopeDialog:s,forceMount:o,children:n,container:r}=e,i=j($,s);return t.jsx(tt,{scope:s,forceMount:o,children:a.Children.map(n,d=>t.jsx(L,{present:o||i.open,children:t.jsx(Ie,{asChild:!0,container:r,children:d})}))})};re.displayName=$;var A="DialogOverlay",ne=a.forwardRef((e,s)=>{const o=ae(A,e.__scopeDialog),{forceMount:n=o.forceMount,...r}=e,i=j(A,e.__scopeDialog);return i.modal?t.jsx(L,{present:n||i.open,children:t.jsx(ot,{...r,ref:s})}):null});ne.displayName=A;var st=qe("DialogOverlay.RemoveScroll"),ot=a.forwardRef((e,s)=>{const{__scopeDialog:o,...n}=e,r=j(A,o);return t.jsx(ke,{as:st,allowPinchZoom:!0,shards:[r.contentRef],children:t.jsx(E.div,{"data-state":z(r.open),...n,ref:s,style:{pointerEvents:"auto",...n.style}})})}),w="DialogContent",ie=a.forwardRef((e,s)=>{const o=ae(w,e.__scopeDialog),{forceMount:n=o.forceMount,...r}=e,i=j(w,e.__scopeDialog);return t.jsx(L,{present:n||i.open,children:i.modal?t.jsx(at,{...r,ref:s}):t.jsx(rt,{...r,ref:s})})});ie.displayName=w;var at=a.forwardRef((e,s)=>{const o=j(w,e.__scopeDialog),n=a.useRef(null),r=F(s,o.contentRef,n);return a.useEffect(()=>{const i=n.current;if(i)return Te(i)},[]),t.jsx(le,{...e,ref:r,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_(e.onCloseAutoFocus,i=>{var d;i.preventDefault(),(d=o.triggerRef.current)==null||d.focus()}),onPointerDownOutside:_(e.onPointerDownOutside,i=>{const d=i.detail.originalEvent,c=d.button===0&&d.ctrlKey===!0;(d.button===2||c)&&i.preventDefault()}),onFocusOutside:_(e.onFocusOutside,i=>i.preventDefault())})}),rt=a.forwardRef((e,s)=>{const o=j(w,e.__scopeDialog),n=a.useRef(!1),r=a.useRef(!1);return t.jsx(le,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:i=>{var d,c;(d=e.onCloseAutoFocus)==null||d.call(e,i),i.defaultPrevented||(n.current||(c=o.triggerRef.current)==null||c.focus(),i.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:i=>{var p,m;(p=e.onInteractOutside)==null||p.call(e,i),i.defaultPrevented||(n.current=!0,i.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const d=i.target;((m=o.triggerRef.current)==null?void 0:m.contains(d))&&i.preventDefault(),i.detail.originalEvent.type==="focusin"&&r.current&&i.preventDefault()}})}),le=a.forwardRef((e,s)=>{const{__scopeDialog:o,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:i,...d}=e,c=j(w,o),p=a.useRef(null),m=F(s,p);return Me(),t.jsxs(t.Fragment,{children:[t.jsx(Fe,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:i,children:t.jsx(Le,{role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":z(c.open),...d,ref:m,onDismiss:()=>c.onOpenChange(!1)})}),t.jsxs(t.Fragment,{children:[t.jsx(nt,{titleId:c.titleId}),t.jsx(lt,{contentRef:p,descriptionId:c.descriptionId})]})]})}),W="DialogTitle",ce=a.forwardRef((e,s)=>{const{__scopeDialog:o,...n}=e,r=j(W,o);return t.jsx(E.h2,{id:r.titleId,...n,ref:s})});ce.displayName=W;var de="DialogDescription",ue=a.forwardRef((e,s)=>{const{__scopeDialog:o,...n}=e,r=j(de,o);return t.jsx(E.p,{id:r.descriptionId,...n,ref:s})});ue.displayName=de;var fe="DialogClose",pe=a.forwardRef((e,s)=>{const{__scopeDialog:o,...n}=e,r=j(fe,o);return t.jsx(E.button,{type:"button",...n,ref:s,onClick:_(e.onClick,()=>r.onOpenChange(!1))})});pe.displayName=fe;function z(e){return e?"open":"closed"}var me="DialogTitleWarning",[Rt,ge]=Pe(me,{contentName:w,titleName:W,docsSlug:"dialog"}),nt=({titleId:e})=>{const s=ge(me),o=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return a.useEffect(()=>{e&&(document.getElementById(e)||console.error(o))},[o,e]),null},it="DialogDescriptionWarning",lt=({contentRef:e,descriptionId:s})=>{const n=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ge(it).contentName}}.`;return a.useEffect(()=>{var i;const r=(i=e.current)==null?void 0:i.getAttribute("aria-describedby");s&&r&&(document.getElementById(s)||console.warn(n))},[n,e,s]),null},ct=te,dt=oe,ut=re,xe=ne,he=ie,ve=ce,ye=ue,ft=pe;const K=ct,Y=dt,pt=ut,Ne=a.forwardRef(({className:e,...s},o)=>t.jsx(xe,{ref:o,className:v("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));Ne.displayName=xe.displayName;const T=a.forwardRef(({className:e,children:s,...o},n)=>t.jsxs(pt,{children:[t.jsx(Ne,{}),t.jsxs(he,{ref:n,className:v("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...o,children:[s,t.jsxs(ft,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[t.jsx(Ve,{className:"h-4 w-4"}),t.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));T.displayName=he.displayName;const k=({className:e,...s})=>t.jsx("div",{className:v("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});k.displayName="DialogHeader";const M=a.forwardRef(({className:e,...s},o)=>t.jsx(ve,{ref:o,className:v("text-lg font-semibold leading-none tracking-tight",e),...s}));M.displayName=ve.displayName;const mt=a.forwardRef(({className:e,...s},o)=>t.jsx(ye,{ref:o,className:v("text-sm text-muted-foreground",e),...s}));mt.displayName=ye.displayName;const gt=Ee("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),je=a.forwardRef(({className:e,variant:s,...o},n)=>t.jsx("div",{ref:n,role:"alert",className:v(gt({variant:s}),e),...o}));je.displayName="Alert";const xt=a.forwardRef(({className:e,...s},o)=>t.jsx("h5",{ref:o,className:v("mb-1 font-medium leading-none tracking-tight",e),...s}));xt.displayName="AlertTitle";const Ce=a.forwardRef(({className:e,...s},o)=>t.jsx("div",{ref:o,className:v("text-sm [&_p]:leading-relaxed",e),...s}));Ce.displayName="AlertDescription";const V="docs-prompts";function G(){if(typeof window>"u")return[];const e=localStorage.getItem(V);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function ht(e){const s=G(),o={...e,id:Date.now().toString(36)+Math.random().toString(36).slice(2,8),createdAt:Date.now()};return s.unshift(o),localStorage.setItem(V,JSON.stringify(s)),o}function vt(e){const s=G(),o=s.filter(r=>r.id!==e),n=o.length!==s.length;return n&&localStorage.setItem(V,JSON.stringify(o)),n}function _t(){const[e,s]=a.useState(""),[o,n]=a.useState(""),[r,i]=a.useState(""),[d,c]=a.useState([]),[p,m]=a.useState([]),[b,y]=a.useState([]),[N,be]=a.useState("ALL"),[De,O]=a.useState(!1),[H,P]=a.useState(""),[h,yt]=a.useState(""),[we,B]=a.useState(!1),[U,C]=a.useState("");a.useEffect(()=>{async function l(){try{const f=await fetch(`/api/prompts?category=${encodeURIComponent(N)}`);if(f.ok){const g=await f.json();m(g.prompts),c(g.categories),y(h?g.prompts.filter(R=>R.title.includes(h)||R.content.includes(h)):g.prompts);return}}catch{}const u=G();m(u),c(Array.from(new Set(u.map(f=>f.category))).sort((f,g)=>f.localeCompare(g)));const x=N==="ALL"?u:u.filter(f=>f.category===N);y(h?x.filter(f=>f.title.includes(h)||f.content.includes(h)):x)}l()},[]),a.useEffect(()=>{async function l(){try{const x=await fetch(`/api/prompts?category=${encodeURIComponent(N)}`);if(x.ok){const f=await x.json();m(f.prompts),c(f.categories),y(h?f.prompts.filter(g=>g.title.includes(h)||g.content.includes(h)):f.prompts);return}}catch{}const u=N==="ALL"?p:p.filter(x=>x.category===N);y(h?u.filter(x=>x.title.includes(h)||x.content.includes(h)):u)}l()},[N]),a.useEffect(()=>{const l=N==="ALL"?p:p.filter(u=>u.category===N);y(h?l.filter(u=>u.title.includes(h)||u.content.includes(h)):l)},[h,p]);async function Re(){const l=e.trim();if(!(!l||!o.trim()||!r.trim())){try{if((await fetch("/api/prompts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({category:l,title:o.trim(),content:r.trim()})})).ok)await J(),C("新增成功"),setTimeout(()=>C(""),2e3);else throw new Error("server")}catch{const u=ht({category:l,title:o.trim(),content:r.trim()});m(x=>{const f=[u,...x];return c(Array.from(new Set(f.map(g=>g.category))).sort((g,R)=>g.localeCompare(R))),f}),C("已保存到本地"),setTimeout(()=>C(""),2e3)}n(""),i("")}}async function _e(l){try{if((await fetch(`/api/prompts?id=${encodeURIComponent(l)}`,{method:"DELETE"})).ok){await J(),C("删除成功"),setTimeout(()=>C(""),2e3);return}}catch{}vt(l)&&(m(x=>{const f=x.filter(g=>g.id!==l);return c(Array.from(new Set(f.map(g=>g.category))).sort((g,R)=>g.localeCompare(R))),f}),C("已从本地删除"),setTimeout(()=>C(""),2e3))}async function J(){try{const l=await fetch(`/api/prompts?category=${encodeURIComponent(N)}`);if(l.ok){const u=await l.json();m(u.prompts),c(u.categories),y(u.prompts)}}catch{}}return t.jsx("div",{className:"flex-1",children:t.jsx("section",{className:"space-y-6 bg-slate-50 py-8 dark:bg-transparent md:py-12 lg:py-24",children:t.jsx("div",{className:"mx-auto px-4 max-w-[1200px] grid gap-6",children:t.jsxs(X,{className:"p-4",children:[t.jsx("h3",{className:"font-bold mb-3",children:"提示词库"}),t.jsxs("div",{className:"grid gap-4",children:[t.jsxs("div",{className:"grid gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-muted-foreground",children:"按分类筛选"}),t.jsxs("select",{value:N,onChange:l=>be(l.target.value),className:"h-8 text-[13px] w-full rounded-md border border-input bg-background px-3",children:[t.jsx("option",{value:"ALL",children:"全部"}),d.map(l=>t.jsx("option",{value:l,children:l},l))]})]}),t.jsx("div",{className:"flex justify-end",children:t.jsxs(K,{open:we,onOpenChange:B,children:[t.jsx(Y,{asChild:!0,children:t.jsx(D,{size:"sm",className:"h-8 px-4 text-[13px]",children:"新增提示词"})}),t.jsxs(T,{className:"sm:max-w-[640px]",children:[t.jsx(k,{children:t.jsx(M,{children:"新增提示词"})}),t.jsxs("div",{className:"grid gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-muted-foreground",children:"选择分类"}),t.jsxs("select",{value:e,onChange:l=>{const u=l.target.value;u==="__ADD__"?setTimeout(()=>O(!0),0):s(u)},className:"h-8 text-[13px] w-full rounded-md border border-input bg-background px-3",children:[d.length===0&&t.jsx("option",{value:"NONE",disabled:!0,children:"暂无分类"}),d.map(l=>t.jsx("option",{value:l,children:l},l)),t.jsx("option",{value:"__ADD__",children:"新建分类…"})]}),De&&t.jsxs("div",{className:"mt-2 grid gap-2 border rounded-md p-2 bg-muted/30",children:[t.jsx(q,{value:H,onChange:l=>P(l.target.value),className:"h-8 text-[13px]",placeholder:"输入分类名称"}),t.jsxs("div",{className:"flex gap-2 justify-end",children:[t.jsx(D,{variant:"outline",size:"sm",className:"h-8 px-3 text-[13px]",onClick:()=>{O(!1),P("")},children:"取消"}),t.jsx(D,{size:"sm",className:"h-8 px-3 text-[13px]",onClick:()=>{const l=H.trim();l&&(c(u=>Array.from(new Set([l,...u])).sort((x,f)=>x.localeCompare(f))),s(l),P(""),O(!1))},children:"确定"})]})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-muted-foreground",children:"标题"}),t.jsx(q,{value:o,onChange:l=>n(l.target.value),className:"h-8 text-[13px]",placeholder:"提示词标题"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"text-xs text-muted-foreground",children:"内容"}),t.jsx(Q,{value:r,onChange:l=>i(l.target.value),rows:6,placeholder:"完整提示词内容"})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(D,{size:"sm",className:"h-8 px-4 text-[13px]",onClick:async()=>{await Re(),B(!1)},children:"保存"})})]})]})]})}),t.jsx("div",{className:"border rounded-md min-h-[120px]",children:b.length===0?t.jsx("div",{className:"p-3 text-sm text-muted-foreground",children:"暂无提示词"}):t.jsx("div",{className:"divide-y",children:b.map(l=>t.jsxs("div",{className:"p-3 flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"min-w-0",children:[t.jsx("div",{className:"text-xs text-muted-foreground",children:l.category}),t.jsx("div",{className:"font-medium truncate max-w-[520px]",children:l.title})]}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(D,{variant:"outline",size:"sm",className:"h-8 px-3 text-[13px]",onClick:()=>{navigator.clipboard.writeText(l.content),C("内容已复制"),setTimeout(()=>C(""),2e3)},children:[t.jsx(We,{className:"w-3.5 h-3.5 mr-1"})," 复制"]}),t.jsxs(K,{children:[t.jsx(Y,{asChild:!0,children:t.jsx(D,{variant:"outline",size:"sm",className:"h-8 px-3 text-[13px]",children:"查看"})}),t.jsxs(T,{className:"sm:max-w-[640px]",children:[t.jsx(k,{children:t.jsx(M,{children:l.title})}),t.jsx("div",{className:"text-sm whitespace-pre-wrap",children:l.content})]})]}),t.jsx(D,{variant:"destructive",size:"sm",className:"h-8 px-3 text-[13px]",onClick:()=>_e(l.id),children:"删除"})]})]},l.id))})})]}),U&&t.jsx(je,{className:"mb-2",children:t.jsx(Ce,{children:U})})]})]})})})})}export{_t as default};
